# Docker技术
你今天的优势会被未来的趋势所取代，所以请持续学习。
## 简介

+ 是什么  
Docker是基于Go实现的云开源项目</br>
Docker的主要目标是“Build, Ship and Run Any App,Anywhere”，也就是通过对用用组件的封装、分发、部署、运行等生命周期的管理，使用户的APP（可以是一个WEB项目或者数据库应用等等）及其运行环境能够做到“一次封装，到处运行”。将应用运行在Docker容器上面，而Docker容器在任何操作系统上都是一致的，这就实现了跨平台、跨服务器。<font color="red">只需要一次配置文件，换到别的机器上就可以一键部署，大大简化了操作。</font></br>
Docker解决了运行环境和配置问题软件容器，方便做持续继承并有助于整体发布的容器虚拟化技术。

+ 发展
    - 虚拟机
    缺点：1.占用资源多 2.冗余步骤多 3.启动慢
    - 容器虚拟化技术
    Linux容器（Linux Containers，简称LXC），不是模拟一个完整的操作系统，而是对进程进行隔离。有了容器就可以将软件运行所需要的所有资源打包到一个隔离的容器中。容器与虚拟机不同，不需要捆绑一整套完整的操作系统，只需要软件工作所欲的库资源和设置。系统因此而变的高效轻量并保证部署在任何的环境中的软件始终如一的运行。
    - Docker与传统的虚拟化方式的不同
        * 传统虚拟技术是虚拟出一套硬件后，在其上运行一个完整的操作系统，在该操作系统上在运行所需应用进程
        * Docker容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟，因此容器与传统虚拟器更为轻便。
        * 每个容器之间相互间隔，每个容器有自己的文件系统，容器之间进程不会相互影响，能区分计算资源。
+ 优势
    - DevOps开发自运维，一次构建、随处运行（提供全部的资源以及环境，避免冲突）
        * 更快速的应用交付和部署
        * 更便捷的升级和扩缩容
        * 更简单的系统运维
        * 更高效的计算资源利用
+ 仓库，Docker Hub官网： https://hub.docker.com

## 安装
+ 前提
    - CentOS仅发行版本中的内核支持Docker
    - 运行在CentOS7上，要求系统为64位，系统内核版本在3.10以上。
    - 运行在CENTOS6.5或者更高版本的CentOS上，要求系统为64位、系统内核版本为2.6.32-431或者更高版本。
    - 查看系统的内核
        ```linux
        uname -r
        ```
+ Docker架构图
![docker架构.png](https://i.loli.net/2019/11/29/Oxyms6T5DVv3XJH.jpg)
+ 基本组成（三要素）
    - 镜像（image)
        一个只读的模板。可以用来创建Docker容器，一个镜像可以创建很多容器。
    - 容器（container)
        是用镜像创建的运行实例，Docker利用容器独立运行一个或一组应用。它可以被启动、开始、停止、删除。每个容器都是相互隔离的、保证安全的平台。可以把容器看做是一个简易版的Linux环境（包括root用户权限、进程空间、用户空间和网络空间等）和运行在其中的程序。容器的定义和镜像几乎一模一样，也是一堆层的统一视角，唯一区别在于容器的最上面那一层是可读可写的。
    - 仓库（repository)
        仓库是集中存放镜像文件的场所。仓库（Repository)和仓库注册服务器（Registry）是有区别的。仓库注册服务器上往往存放着多个仓库，每个仓库中又包含了多个镜像，每个镜像有不同的标签（tag）。仓库分为公开仓库（Public）和私有仓库（Private)两种形式。最大的公开仓库是Docker Hub（https://hub.docker/com/），存放了大量的镜像供用户下载，国内的公开仓库包括阿里云、网易云等。

+ 总结，正确理解仓库/镜像/容器这几个概念
    Docker本身是一个容器运行载体或称之为管理引擎。我们把应用程序和配置依赖打包好形成一个可交付的运行环境，这个打包好的运行环境就是一个image镜像文件。只有通过这个镜像文件才能生成Docker容器。image文件可以看作是容器的模板。Docker根据image文件生成容器的实例。同一个image文件，可以生成多个同时运行的容器实例。

+ 安装，见官方文档：https://docs.docker.com/install/linux/docker-ce/centos/
## 使用
+ 安装完成后使用`sudo systemctl start docker`启动docker服务
+ 推荐使用阿里云镜像加速：注册阿里云，搜索容器镜像服务，按照提示进行申请
+ 配置完阿里云镜像后，使用`docker info`命令查看`Registry Mirrors`项是否是阿里云镜像的地址
+ 通过运行hello-world镜像来验证是否正确安装了Docker Engine-Community 。运行`docker run hello-world`命令。
    - docker run 镜像，运行相应的镜像，运行时首先会在本地寻找此镜像，若没有，会自动从设置的仓库中进行拉取，然后在容器中运行
    - 第一次运行时，会得到提示：`Unable to find image 'hello-world:latest' locally`，意思是本地没有该镜像，然后从仓库拉取，并在容器中运行
    - `hello-world:latest`后面的`:latest`为版本号，不写，则默认为latest
    - run的过程
        1. 在Docker本机中寻找该镜像，看本机是否有该镜像，若有，则以该镜像为模板生产容器实例运行
        2. 若本地没有则去Docker Hub上查找该镜像（若设置了阿里云镜像，则在阿里云镜像进行查找），能找到则下载该镜像到本地，以该镜像为模板生产容器实例运行
        3. 若未能找到，则返回失败，找不到该镜像

+ 底层原理
    - Docker是怎么工作的
        Docker是一个Client-Server结构的系统，Docker守护进程运行在主机上，然后通过Socket连接从客户端访问，守护进程从客户端接受命令并管理运行在主机上的容器，容器，是一个运行环境，就是所谓的集装箱。
    - Docker为什么快
        * docker有着比虚拟机更少的抽象层。不需要Hypervisor实现硬件资源虚拟化，运行在docker上的程序直接使用的都是实际物理机硬件资源。因此在CPU、内存利用率上都有着更为明显的优势
        ![docker.png](https://i.loli.net/2019/11/29/K9tEiTJuX5lnRdO.jpg)

        * docker利用的是宿主机的内核，而不是Guest OS。docker直接利用宿主机的操作系统，新建一个docker容器只需要几秒钟。
    - Docker和虚拟机的区别

    ![docker与虚拟机的区别.jpg](https://i.loli.net/2019/11/29/LsfpxybV6eXDHO5.jpg)

### Docker常用命令
+ docker info，对Docker信息的概括
+ docker version，查看Docker的版本
+ docker --help，Docker命令的帮助


